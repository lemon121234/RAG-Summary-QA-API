# ç©©å®šæ€§é©—è­‰èˆ‡ Debug åŠŸèƒ½

## ğŸ“Š ç©©å®šæ€§æ¸¬è©¦

### åŸ·è¡Œç©©å®šæ€§æ¸¬è©¦

```bash
python tests/stability_test.py
```

### æ¸¬è©¦å…§å®¹

1. **Embedding ä¸€è‡´æ€§æ¸¬è©¦**
   - é©—è­‰åŒä¸€æ–‡æœ¬å¤šæ¬¡ç”Ÿæˆ embedding æ˜¯å¦ç›¸åŒ
   - ç¢ºä¿ embedding çš„ deterministic ç‰¹æ€§

2. **Chunking ä¸€è‡´æ€§æ¸¬è©¦**
   - é©—è­‰åŒä¸€æ–‡æœ¬å¤šæ¬¡åˆ‡å‰²æ˜¯å¦ç”¢ç”Ÿç›¸åŒçš„ chunks
   - ç¢ºä¿ chunking éç¨‹çš„ç©©å®šæ€§

3. **Retrieval ä¸€è‡´æ€§æ¸¬è©¦**
   - é©—è­‰åŒä¸€ query å¤šæ¬¡æª¢ç´¢æ˜¯å¦è¿”å›ç›¸åŒçµæœ
   - ç¢ºä¿æª¢ç´¢éç¨‹çš„ deterministic ç‰¹æ€§

### æ¸¬è©¦çµæœ

æ¸¬è©¦çµæœæœƒä¿å­˜åœ¨ `debug_logs/stability_test_stability_test.json`ï¼ŒåŒ…å«ï¼š
- æ¯å€‹æ¸¬è©¦çš„é€šé/å¤±æ•—ç‹€æ…‹
- è©³ç´°çš„å·®ç•°å ±å‘Šï¼ˆå¦‚æœæœ‰ï¼‰
- çµ±è¨ˆæ‘˜è¦

---

## ğŸ” Debug Logging

### è‡ªå‹•è¨˜éŒ„

æ¯æ¬¡ RAG æŸ¥è©¢éƒ½æœƒè‡ªå‹•è¨˜éŒ„åˆ°ï¼š
- **æ§åˆ¶å°è¼¸å‡º**ï¼šå³æ™‚æŸ¥çœ‹
- **`rag_debug.log`**ï¼šæ–‡æœ¬æ—¥èªŒæ–‡ä»¶
- **`debug_logs/session_*.json`**ï¼šçµæ§‹åŒ–çš„æœƒè©±è¨˜éŒ„

### è¨˜éŒ„å…§å®¹

1. **æª¢ç´¢éç¨‹è¨˜éŒ„**
   - æŸ¥è©¢æ–‡æœ¬
   - æª¢ç´¢åˆ°çš„ chunksï¼ˆå«ç›¸ä¼¼åº¦åˆ†æ•¸ï¼‰
   - Top-k åƒæ•¸
   - çµ±è¨ˆä¿¡æ¯ï¼ˆå¹³å‡åˆ†æ•¸ã€æœ€é«˜/æœ€ä½åˆ†æ•¸ï¼‰

2. **å®Œæ•´ RAG æœƒè©±è¨˜éŒ„**
   - å•é¡Œ
   - æª¢ç´¢åˆ°çš„ chunksï¼ˆå«åˆ†æ•¸å’Œå…§å®¹é è¦½ï¼‰
   - ç”Ÿæˆçš„ç­”æ¡ˆ
   - ä¿¡å¿ƒç¨‹åº¦
   - ç­”æ¡ˆå“è³ªæŒ‡æ¨™

### ä½¿ç”¨æ–¹å¼

Debug logger å·²æ•´åˆåˆ° `routes/rag.py`ï¼Œç„¡éœ€é¡å¤–é…ç½®ã€‚

### æŸ¥çœ‹è¨˜éŒ„

```bash
# æŸ¥çœ‹æ–‡æœ¬æ—¥èªŒ
cat rag_debug.log

# æŸ¥çœ‹æœƒè©±è¨˜éŒ„
ls debug_logs/session_*.json
```

### æ‰‹å‹•è¨˜éŒ„

```python
from utils.debug_logger import rag_debug_logger

# è¨˜éŒ„æª¢ç´¢
rag_debug_logger.log_retrieval(
    query="ä½ çš„å•é¡Œ",
    retrieved_chunks=results,
    top_k=5
)

# è¨˜éŒ„å®Œæ•´æœƒè©±
rag_debug_logger.log_full_rag_session(
    question="ä½ çš„å•é¡Œ",
    retrieved_chunks=results,
    answer="ç­”æ¡ˆ",
    confidence="high",
    top_k=5
)

# ä¿å­˜æœƒè©±æ‘˜è¦
rag_debug_logger.save_session_summary()
```

---

## ğŸ¯ é¢è©¦æ™‚å¯ä»¥å¼·èª¿çš„é»

### ç©©å®šæ€§é©—è­‰

> ã€Œæˆ‘å¯¦ä½œäº†ç©©å®šæ€§æ¸¬è©¦è…³æœ¬ï¼Œé©—è­‰ç³»çµ±çš„ deterministic ç‰¹æ€§ã€‚æ¸¬è©¦åŒ…æ‹¬ embedding ä¸€è‡´æ€§ã€chunking ä¸€è‡´æ€§ã€å’Œ retrieval ä¸€è‡´æ€§ã€‚é€™ç¢ºä¿äº†ç›¸åŒè¼¸å…¥æœƒç”¢ç”Ÿç›¸åŒè¼¸å‡ºï¼Œé¿å…äº†éš¨æ©Ÿæ€§å°è‡´çš„å•é¡Œã€‚ã€

### Debug èƒ½åŠ›

> ã€Œæˆ‘å»ºç«‹äº†å®Œæ•´çš„ debug logging ç³»çµ±ï¼Œæ¯æ¬¡ RAG æŸ¥è©¢éƒ½æœƒè‡ªå‹•è¨˜éŒ„æª¢ç´¢éç¨‹å’Œå•ç­”çµæœã€‚é€™è®“æˆ‘å¯ä»¥å¿«é€Ÿå®šä½å•é¡Œï¼šå¦‚æœç­”æ¡ˆä¸æº–ç¢ºï¼Œæˆ‘å¯ä»¥æŸ¥çœ‹æª¢ç´¢åˆ°çš„ chunks å’Œç›¸ä¼¼åº¦åˆ†æ•¸ï¼Œåˆ¤æ–·å•é¡Œæ˜¯åœ¨ retrieval éšæ®µé‚„æ˜¯ç”Ÿæˆéšæ®µã€‚ã€

### å·¥ç¨‹æ€ç¶­

> ã€Œé€™é«”ç¾äº†æˆ‘çš„å·¥ç¨‹æ€ç¶­ï¼šä¸åªæ˜¯å¯¦ç¾åŠŸèƒ½ï¼Œé‚„è¦ç¢ºä¿ç³»çµ±çš„å¯è§€å¯Ÿæ€§ï¼ˆobservabilityï¼‰å’Œå¯èª¿è©¦æ€§ï¼ˆdebuggabilityï¼‰ã€‚é€™åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­éå¸¸é‡è¦ã€‚ã€

---

## ğŸ“ æ–‡ä»¶çµæ§‹

```
.
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ debug_logger.py      # Debug logging å·¥å…·
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ stability_test.py    # ç©©å®šæ€§æ¸¬è©¦è…³æœ¬
â”œâ”€â”€ debug_logs/              # Debug è¨˜éŒ„ç›®éŒ„
â”‚   â”œâ”€â”€ session_*.json       # æœƒè©±è¨˜éŒ„
â”‚   â””â”€â”€ stability_test_*.json # æ¸¬è©¦çµæœ
â””â”€â”€ rag_debug.log            # æ–‡æœ¬æ—¥èªŒ
```


